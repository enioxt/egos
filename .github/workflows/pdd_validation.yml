# PDD-CI-VAL: Validate all PDD YAML files on every push / PR
# Auto-generated by Cascade on 2025-06-15

name: PDD Validation

on:
  push:
    paths:
      - 'docs/prompts/pdds/**.yaml'
      - '.github/workflows/pdd_validation.yml'
  pull_request:
    paths:
      - 'docs/prompts/pdds/**.yaml'
  workflow_dispatch:

jobs:
  validate-pdds:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install PDD validation dependencies
        run: |
          pip install --upgrade pip
          # If project has requirements
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          # Ensure pydantic available for schema validation
          pip install pydantic

      - name: Validate all PDDs
        run: |
          failures=0
          shopt -s globstar nullglob
          for file in docs/prompts/pdds/**/*.yaml; do
            echo "Validating $file"
            python subsystems/KOIOS/schemas/validate_pdd.py "$file" || failures=$((failures+1))
          done
          if [ $failures -ne 0 ]; then
            echo "PDD validation failed on $failures file(s)."; exit 1; fi
